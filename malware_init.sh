#!/bin/bash
#set -x

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

if [[ -f "/usr/bin/apt" ]]; then
	apt install -y fail2ban

	echo "--"
	echo "Enable fail2ban"
	service fail2ban start

	echo "--"
	echo "Start AppArmor"
	systemctl start apparmor

	if [[ -f "/etc/init.d/apache2" ]]; then

		echo "--"
		echo "Restart Apache"
		mkdir -p /var/log/apache2/
		/etc/init.d/apache2 restart
	fi

	echo "--"
	echo "Start Syslog"
	service syslog start

	echo "--"
	echo "Enable Firewall (please answer yes)"
	sudo ufw enable
fi

if [[ -f "/usr/bin/yum" ]]; then
	yum install -y fail2ban-server
	yum install -y firewalld

	echo "--"
	echo "Enable SELinux"
	sudo setenforce 1

	echo "--"
	echo "Start rsyslog"
	systemctl start rsyslog.service
	service rsyslog start
	systemctl enable firewalld

fi

## Linux commands for both RPM / DEB
echo "--"
echo "Create TXT file"
echo "Test file" >file.txt

echo "--"
echo "Delete User John"
userdel John 2>/dev/null

echo "--"
echo "Delete keys and crypted files"
rm *.pem *.crypted 2>/dev/null

